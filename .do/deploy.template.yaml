spec:
  databases:
  - engine: PG
    name: db
    num_nodes: 1
    size: db-s-dev-database
    version: "12"
  envs:
  - key: RAILS_ENV
    scope: RUN_AND_BUILD_TIME
    value: production
  - key: RAILS_SERVE_STATIC_FILES
    scope: RUN_AND_BUILD_TIME
    value: "true"
  - key: RAILS_LOG_TO_STDOUT
    scope: RUN_AND_BUILD_TIME
    value: "true"
  - key: SECRET_KEY_BASE
    scope: RUN_AND_BUILD_TIME
    value: "REPLACE_WITH_SOMETHING_SECURE"
  - key: DB_DATABASE
    scope: RUN_AND_BUILD_TIME
    value: ${db.DATABASE}
  - key: DB_HOST
    scope: RUN_AND_BUILD_TIME
    value: ${db.HOSTNAME}
  - key: DB_PORT
    scope: RUN_AND_BUILD_TIME
    value: ${db.PORT}
  - key: DB_USER
    scope: RUN_AND_BUILD_TIME
    value: ${db.USERNAME}
  - key: DB_PASSWORD
    scope: RUN_AND_BUILD_TIME
    value: ${db.PASSWORD}
  - key: DATABASE_URL
    scope: RUN_TIME
    value: ${db.DATABASE_URL}
  - key: DATABASE_URL
    scope: RUN_TIME
    value: ${db.DATABASE_URL}      
  name: trustbin
  region: nyc
  services:
    - environment_slug: ruby-on-rails
      envs:
      git:
        branch: do-button
        repo_clone_url: https://github.com/scott/trust_bin.git
      http_port: 8080
      instance_count: 1
      instance_size_slug: basic-xxs
      name: trustbin-app
      routes:
      - path: /
      run_command: rails server -p $PORT -e ${RAILS_ENV:-production}
      source_dir: /

  # jobs:
  # - name: trustbin-migrate
  #   environment_slug: ruby-on-rails
  #   git:
  #     branch: do-button
  #     repo_clone_url: https://github.com/scott/trust_bin.git
  #   instance_count: 1
  #   instance_size_slug: basic-xxs
  #   kind: POST_DEPLOY
  #   run_command: bundle exec rails db:install
  #   source_dir: /